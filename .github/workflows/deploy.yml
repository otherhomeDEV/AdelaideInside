name: Deploy to Server

on:
  push:
    branches:
      - main  # 배포할 브랜치를 지정합니다.

jobs:
  deploy:
    runs-on: ubuntu-latest  # 실행할 환경을 지정합니다. Ubuntu 최신 버전을 사용합니다.

    steps:
    - name: Checkout Repository  # 코드를 체크아웃합니다.
      uses: actions/checkout@v2
      
    - name: Install lftp  # lftp를 설치합니다.
      run: sudo apt-get install lftp -y

    - name: Deploy via FTP  # FTP를 통해 파일을 서버로 전송합니다.
      run: |
        lftp -c "
        open -u $FTP_USERNAME,$FTP_PASSWORD $FTP_SERVER;
        mirror -R ./path/to/source/files /root/aidev;
        bye;
        "
      env:
        FTP_SERVER: ${{ secrets.FTP_SERVER }}  # FTP 서버 주소를 Secrets에서 가져와 환경 변수로 설정합니다.
        FTP_USERNAME: ${{ secrets.FTP_USERNAME }}  # FTP 사용자 이름을 Secrets에서 가져와 환경 변수로 설정합니다.
        FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}  # FTP 비밀번호를 Secrets에서 가져와 환경 변수로 설정합니다.

    - name: Restart Docker container  # Docker 컨테이너를 재시작합니다.
      run: docker restart DevAI
